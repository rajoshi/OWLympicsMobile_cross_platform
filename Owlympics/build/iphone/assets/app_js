function initialise(){socialtxt.setHintText="0",lowtxt.setHintText="0",medtxt.setHintText="0",hightxt.setHintText="0",socialtxt.value="",lowtxt.value="",medtxt.value="",hightxt.value="",social="0",low="0",med="0",high="0",mydate=new Date,day=mydate.getDate(),mon=mydate.getMonth()+1,year=mydate.getFullYear(),a=mydate.getFullYear(),b=mydate.getMonth(),c=mydate.getDate(),useractivity="",workout="",workoutstate="",exrate=3,haprate=3,""!=atgeotext?(atgeo.backgroundImage="images/greenrect.png",here.backgroundImage="images/grayrect.png",otherloc.setHintText="Type other",otherloc.backgroundColor="white",workout=atgeotext,workoutstate="Geo-fenced"):Titanium.Geolocation.getCurrentPosition(function(e){e.success?(workout=e.coords.latitude.toString()+","+e.coords.longitude.toString(),workoutstate="Here",here.backgroundImage="images/greenrect.png",atgeo.backgroundImage="images/grayrect.png",otherloc.setHintText="Type other",otherloc.backgroundColor="white"):(here.backgroundImage="images/grayrect.png",workoutstate="Location unavailable",workout="")}),othertxt.setHintText="Type other",othertxt.backgroundColor="white",activitybtn1.backgroundImage="./images/gray.png",activitybtn2.backgroundImage="./images/gray.png",activitybtn3.backgroundImage="./images/gray.png",activitybtn4.backgroundImage="./images/gray.png",activitybtn5.backgroundImage="./images/gray.png",hstar1.backgroundImage="./images/goldstar.png",hstar2.backgroundImage="./images/goldstar.png",hstar3.backgroundImage="./images/goldstar.png",hstar4.backgroundImage="./images/dullstar.png",hstar5.backgroundImage="./images/dullstar.png"}function submitinfo(){if(Titanium.Network.networkType===Titanium.Network.NETWORK_NONE)alert("Could not submit, Please check internet connection.");else{low=lowtxt.value,high=hightxt.value,med=medtxt.value,social=socialtxt.value;var e=Titanium.UI.createAlertDialog({title:"Submit Data",message:"Submit the following information? \nLocation : "+workoutstate+"\nActivity : "+useractivity+" \nLow Intensity : "+low+" \nMed Intensity : "+med+" \nHigh Intensity : "+high+"\nNumber of Participants : "+social+"\nDate : "+mon+"-"+day+"-"+year+"\nHapiness rating : "+haprate+" stars",buttonNames:["Yes","No"],cancel:1});if(""!=workout&&""!=useractivity&&0!=day&&low+med+high>0){var t={day:day.toString(),mon:mon.toString(),year:year.toString(),activity:useractivity,social:social,lowintensity:low,moderateintensity:med,highintensity:high,note:"",rate:"1",hour:mydate.getHours().toString(),min:mydate.getMinutes().toString(),sec:mydate.getSeconds().toString(),happy:haprate.toString(),activeness:exrate.toString(),uuid:Titanium.Platform.id,latlon:workout};e.show()}else alert("Please fill all fields; location, exercise, time ");e.addEventListener("click",function(e){if(Titanium.API.info("e = "+JSON.stringify(e)),e.cancel!==e.index&&e.cancel!==!0)switch(e.index){case 0:Titanium.API.info("Clicked button 0 (YES)"),submitReq.send(t);break;case 1:Titanium.API.info("Clicked button 1 (NO)")}})}}function profileUpdate(){if(Titanium.Network.networkType===Titanium.Network.NETWORK_NONE)alert("Could not refresh activities, Please check internet connection.");else{profileReq.open("POST","http://owlympics.ecg.rice.edu:81/mobile/profile");var e={uuid:Titanium.Platform.id};profileReq.send(e)}}function distance(e,t,a,i){var o=Math.PI*e/180,r=Math.PI*a/180,n=(Math.PI*t/180,Math.PI*i/180,t-i),l=Math.PI*n/180,d=Math.sin(o)*Math.sin(r)+Math.cos(o)*Math.cos(r)*Math.cos(l);return d=Math.acos(d),d=180*d/Math.PI,d=60*d*1.1515,d=1.609344*d*1e3}Ti.version<1.8&&alert("Sorry - this application template requires Titanium Mobile SDK 1.8 or later"),Titanium.UI.setBackgroundColor("#000");var osname=Ti.Platform.osname,version=Ti.Platform.version,height=Ti.Platform.displayCaps.platformHeight,width=Ti.Platform.displayCaps.platformWidth,isTablet="ipad"===osname||"android"===osname&&(width>899||height>899),homeWin=Titanium.UI.createWindow({title:"OWLympics",backgroundImage:"./images/thisbackground.jpg",orientationModes:[Titanium.UI.PORTRAIT],statusBarStyle:Ti.UI.iPhone.StatusBar.LIGHT_CONTENT});Ti.Geolocation.purpose="Smart Reminders";var service=Ti.App.iOS.registerBackgroundService({url:"bg.js"}),coords=Ti.Filesystem.getFile(Ti.Filesystem.applicationDataDirectory,"coords.txt");coords.exists()&&coords.writable&&(coords.deleteFile(),coords.createFile());var enterfile=Ti.Filesystem.getFile(Ti.Filesystem.applicationDataDirectory,"enterflag.txt");enterfile.exists()&&enterfile.writable&&(enterfile.deleteFile(),enterfile.createFile());var stayfile=Ti.Filesystem.getFile(Ti.Filesystem.applicationDataDirectory,"stayflag.txt");stayfile.exists()&&stayfile.writable&&(stayfile.deleteFile(),stayfile.createFile());var stampfile=Ti.Filesystem.getFile(Ti.Filesystem.applicationDataDirectory,"stamp.txt");stampfile.exists()&&stampfile.writable&&(stampfile.deleteFile(),stampfile.createFile());var currentlocation=new Array;currentlocation[0]=0,currentlocation[1]=0;var profileView=Titanium.UI.createView({top:20,height:"100%",width:"100%",top:0,left:0}),profilechildView=Titanium.UI.createView({top:150,height:"50%",width:"100%",left:0});profileView.add(profilechildView);var height1=Ti.Platform.displayCaps.platformHeight,width1=Ti.Platform.displayCaps.platformWidth;"android"===Ti.Platform.osname&&(width>899||height>999)&&(height1/=2,width1/=2),"ipad"===Ti.Platform.osname&&(height1/=2,width1=width1);var whatView=Ti.UI.createView({height:2.5*height1,width:width1,top:0,left:0}),vertiscroll=Ti.UI.createScrollView({top:20,contentWidth:"auto",contentHeight:2.5*height1,showVerticalScrollIndicator:!0,showHorizontalScrollIndicator:!1,height:"100%",width:"100%"});vertiscroll.add(whatView);var MapModule=require("ti.map"),mapview=MapModule.createView({mapType:MapModule.NORMAL_TYPE,region:{latitude:29.719728,longitude:-95.399029},animate:!0,regionFit:!0,userLocation:!1,height:"70%",top:"20%",width:Ti.UI.FILL-10,left:5}),optionsView=Ti.UI.createView({backgroundImage:"./images/thisbackground.jpg",height:"100%",width:"100%",top:0,left:0});homeWin.add(optionsView),optionsView.hide();var scrollable=Titanium.UI.createScrollableView({views:[profileView,vertiscroll,mapview],showPagingControl:!0});homeWin.add(scrollable);var more=Ti.UI.createButton({top:"0%",left:"87.5%",width:40,height:40,backgroundImage:"./images/more.png",backgroundSelectedImage:"./images/morecopy.png"}),more1=Ti.UI.createButton({top:"0%",left:"75%",text:"                   ",width:40,height:40,width:Ti.UI.SIZE,height:Ti.UI.SIZE}),morelabel=Ti.UI.createLabel({text:"Options",font:{fontSize:15},top:"1%",left:"75%",color:"gray",width:Ti.UI.SIZE,height:Ti.UI.SIZE});whatView.add(more),whatView.add(more1),whatView.add(morelabel),more.addEventListener("click",function(){optionsView.show(),scrollable.hide()}),more1.addEventListener("click",function(){more.backgroundImage="./images/morecopy.png",optionsView.show(),scrollable.hide(),more.backgroundImage="./images/more.png"}),homeWin.add(scrollable);var back=Ti.UI.createButton({title:"Back",color:"gray",top:"5%",left:"5%",width:80,height:30});optionsView.add(back),back.addEventListener("click",function(){optionsView.hide(),scrollable.show(),scrollable.scrollToView(vertiscroll)});var exrate=1,haprate=1,whereLabel=Ti.UI.createLabel({text:"Where did you exercise?",color:"white",font:{fontSize:20},top:"3%",textAlign:Ti.UI.TEXT_ALIGNMENT_CENTER});whatView.add(whereLabel);var here=Ti.UI.createButton({top:"5%",left:"10%",color:"black",font:{fontSize:20},width:100,title:"Here",backgroundImage:"./images/grayrect.png",backgroundImageSelected:"./images/greenrect.png"});whatView.add(here);var atgeo=Ti.UI.createButton({top:"5%",left:"45%",color:"black",font:{fontSize:20},width:140,title:"Geo-fenced",backgroundImage:"./images/grayrect.png",backgroundImageSelected:"./images/greenrect.png"});whatView.add(atgeo);var atgeotext="",otherloc=Ti.UI.createTextField({color:"black",font:{fontSize:20},top:"8.7%",width:250,height:65,backgroundColor:"white",backgroundImage:"none",textAlign:"center",hintText:"Type other"});whatView.add(otherloc);var workout,selectlabel=Ti.UI.createLabel({text:"Which exercise did you do?",color:"white",font:{fontSize:20},top:"15%",textAlign:Ti.UI.TEXT_ALIGNMENT_CENTER});whatView.add(selectlabel);var activitybtn1=Ti.UI.createButton({title:"Run",color:"black",font:{fontSize:18},top:"17.5%",left:"10%",width:80,height:80,backgroundImage:"./images/gray.png",backgroundSelectedImage:"./images/green.png"});whatView.add(activitybtn1);var activitybtn2=Ti.UI.createButton({title:"Walk",color:"black",font:{fontSize:18},top:"17.5%",left:"38.1%",width:80,height:80,backgroundImage:"./images/gray.png",backgroundSelectedImage:"./images/green.png"});whatView.add(activitybtn2);var activitybtn3=Ti.UI.createButton({title:"Swim",color:"black",font:{fontSize:18},top:"17.5%",left:"66%",width:80,height:80,backgroundImage:"./images/gray.png",backgroundSelectedImage:"./images/green.png"});whatView.add(activitybtn3);var activitybtn4=Ti.UI.createButton({title:"Cycle",color:"black",font:{fontSize:19},top:"24%",left:"23%",width:80,height:80,backgroundImage:"./images/gray.png",backgroundSelectedImage:"./images/green.png"});whatView.add(activitybtn4);var activitybtn5=Ti.UI.createButton({title:"Weight",color:"black",font:{fontSize:19},top:"24%",left:"54%",width:80,height:80,backgroundImage:"./images/gray.png",backgroundSelectedImage:"./images/green.png"});whatView.add(activitybtn5);var othertxt=Ti.UI.createTextField({color:"black",font:{fontSize:20},top:"31%",width:160,height:65,backgroundColor:"white",backgroundImage:"none",textAlign:"center",hintText:"Type other"});whatView.add(othertxt);var timelabel=Ti.UI.createLabel({text:"Exercise duration in minutes:",color:"white",font:{fontSize:20},top:"39%",textAlign:Ti.UI.TEXT_ALIGNMENT_CENTER});whatView.add(timelabel);var lowLabel=Ti.UI.createLabel({text:"Low",color:"white",font:{fontSize:20},top:"42%",left:"15%"});whatView.add(lowLabel);var medLabel=Ti.UI.createLabel({text:"Med",color:"white",font:{fontSize:20},top:"42%",left:"42%"});whatView.add(medLabel);var highLabel=Ti.UI.createLabel({text:"High",color:"white",font:{fontSize:20},top:"42%",left:"67%"});whatView.add(highLabel);var lowtxt=Ti.UI.createTextField({color:"black",font:{fontSize:20},top:"44%",left:"10%",width:75,height:60,backgroundColor:"white",backgroundImage:"none",hintText:"0",keyboardType:Titanium.UI.KEYBOARD_NUMBER_PAD});whatView.add(lowtxt);var medtxt=Ti.UI.createTextField({color:"black",font:{fontSize:20},top:"44%",left:"37.5%",width:75,height:60,backgroundColor:"white",backgroundImage:"none",hintText:"0",keyboardType:Titanium.UI.KEYBOARD_NUMBER_PAD});whatView.add(medtxt);var hightxt=Ti.UI.createTextField({color:"black",font:{fontSize:20},top:"44%",left:"65%",width:75,height:60,backgroundColor:"white",backgroundImage:"none",hintText:"0",keyboardType:Titanium.UI.KEYBOARD_NUMBER_PAD});whatView.add(hightxt);var socialLabel=Ti.UI.createLabel({text:"Number of other\nparticipants",color:"white",font:{fontSize:20},top:"51%",left:"10%"});whatView.add(socialLabel);var socialtxt=Ti.UI.createTextField({color:"black",font:{fontSize:20},top:"51%",left:"70%",width:70,height:60,backgroundColor:"white",backgroundImage:"none",keyboardType:Titanium.UI.KEYBOARD_NUMBER_PAD,hintText:"0"});whatView.add(socialtxt);var screenWidth=width1,calview=Ti.UI.createView({top:"58%",width:"322dp",height:330});whatView.add(calview);var prevMonth=Ti.UI.createButton({left:"25dp",width:40,height:40,font:{fontSize:25,fontWeight:"bold"},title:"<"}),nextMonth=Ti.UI.createButton({right:"25dp",width:40,height:40,font:{fontSize:25,fontWeight:"bold"},title:">"}),monthTitle=Ti.UI.createLabel({width:"200dp",height:"24dp",textAlign:"center",color:"#000000",font:{fontSize:20,fontWeight:"bold"}}),toolBar=Ti.UI.createView({top:"0dp",width:"322dp",height:"50dp",backgroundColor:"#848485",layout:"vertical"}),toolBarTitle=Ti.UI.createView({top:"3dp",width:"322dp",height:"24dp"});toolBarTitle.add(monthTitle);var toolBarDays=Ti.UI.createView({top:"2dp",width:"322dp",height:"22dp",layout:"horizontal",left:"-1dp"});toolBarDays.sunday=Ti.UI.createLabel({left:"0dp",height:"20dp",text:"Sun",width:"46dp",textAlign:"center",font:{fontSize:12,fontWeight:"bold"},color:"#3a4756"}),toolBarDays.monday=Ti.UI.createLabel({left:"0dp",height:"20dp",text:"Mon",width:"46dp",textAlign:"center",font:{fontSize:12,fontWeight:"bold"},color:"#3a4756"}),toolBarDays.tuesday=Ti.UI.createLabel({left:"0dp",height:"20dp",text:"Tue",width:"46dp",textAlign:"center",font:{fontSize:12,fontWeight:"bold"},color:"#3a4756"}),toolBarDays.wednesday=Ti.UI.createLabel({left:"0dp",height:"20dp",text:"Wed",width:"46dp",textAlign:"center",font:{fontSize:12,fontWeight:"bold"},color:"#3a4756"}),toolBarDays.thursday=Ti.UI.createLabel({left:"0dp",height:"20dp",text:"Thu",width:"46dp",textAlign:"center",font:{fontSize:12,fontWeight:"bold"},color:"#3a4756"}),toolBarDays.friday=Ti.UI.createLabel({left:"0dp",height:"20dp",text:"Fri",width:"46dp",textAlign:"center",font:{fontSize:12,fontWeight:"bold"},color:"#3a4756"}),toolBarDays.saturday=Ti.UI.createLabel({left:"0dp",height:"20dp",text:"Sat",width:"46dp",textAlign:"center",font:{fontSize:12,fontWeight:"bold"},color:"#3a4756"}),toolBarDays.add(toolBarDays.monday),toolBarDays.add(toolBarDays.tuesday),toolBarDays.add(toolBarDays.wednesday),toolBarDays.add(toolBarDays.thursday),toolBarDays.add(toolBarDays.friday),toolBarDays.add(toolBarDays.saturday),toolBarDays.add(toolBarDays.sunday),toolBar.add(toolBarTitle),toolBar.add(toolBarDays),dayView=function(e){var t=Ti.UI.createLabel({current:e.current,width:"46dp",height:"44dp",backgroundColor:"#DCDCDF",text:e.day,textAlign:"center",color:e.color,font:{fontSize:20,fontWeight:"bold"}});return t},monthName=function(e){switch(e){case 0:e="January";break;case 1:e="February";break;case 2:e="March";break;case 3:e="April";break;case 4:e="May";break;case 5:e="June";break;case 6:e="July";break;case 7:e="August";break;case 8:e="September";break;case 9:e="October";break;case 10:e="November";break;case 11:e="December"}return e};var oldDay=1,calView=function(e,t,a,o){var r=(monthName(t),Ti.UI.createView({layout:"horizontal",width:"322dp",height:"auto",top:"50dp"})),n=32-new Date(e,t,32).getDate(),l=new Date(e,t,a).getDate(),d=new Date(e,t,1).getDay(),c=32-new Date(e,t-1,32).getDate(),g=new Date(e,t,n).getDay()-6,s=c-d+1;for(i=0;d>i;i++)r.add(new dayView({day:s,color:"#8e959f",current:"no",dayOfMonth:""})),s++;if(s=1,o){for(i=0;n>i;i++){var h=new dayView({day:s,color:"#8e959f",current:"yes",dayOfMonth:l});r.add(h),i+1>n-14+l&&(h.color="#3a4756"),s++}for(s=1,oldDay=0,i=0;i>g;i--)r.add(new dayView({day:s,color:"#8e959f",current:"no",dayOfMonth:""})),s++}else{for(i=0;n>i;i++){var h=new dayView({day:s,color:"#3a4756",current:"yes",dayOfMonth:l});r.add(h),h.text==l&&(h.color="white",h.backgroundColor="#00cc66",oldDay=h),l-14>i&&(h.color="#8e959f"),i+1>l&&(h.color="#8e959f"),s++}for(s=1,i=0;i>g;i--)r.add(new dayView({day:s,color:"#8e959f",current:"no",dayOfMonth:""})),s++}return r.addEventListener("click",function(i){"yes"==i.source.current&&(o||i.source.text<=l&&i.source.text>=l-14&&(oldDay.text==l?(oldDay.color="white",oldDay.backgroundColor="#333333"):oldDay.text<l&&oldDay.text>l-14&&(oldDay.color="#3a4756",oldDay.backgroundColor="#DCDCDF"),oldDay.backgroundPaddingLeft="0dp",oldDay.backgroundPaddingBottom="0dp",i.source.text==l?(i.source.backgroundColor="#00cc66",day=a,mon=t+1,year=e):i.source.text<l&&i.source.text>l-14?(i.source.backgroundColor="#00cc66",day=i.source.text,mon=t+1,year=e):(0!=oldDay&&(oldDay.text>n-14+l&&(oldDay.color="#3a4756",oldDay.backgroundColor="#DCDCDF"),oldDay.backgroundPaddingLeft="0dp",oldDay.backgroundPaddingBottom="0dp"),i.source.text>n-14+l&&(i.source.backgroundColor="#00cc66",day=i.source.text,mon=t+1,year=e)),i.source.backgroundPaddingLeft="1dp",i.source.backgroundPaddingBottom="1dp",oldDay=i.source))}),r},mydate=new Date;a=mydate.getFullYear(),b=mydate.getMonth(),c=mydate.getDate();var prevCalendarView=null;prevCalendarView=0==b?calView(a-1,11,c,1):calView(a,b-1,c,1),prevCalendarView.left=-1*screenWidth+"dp";var nextCalendarView=null;nextCalendarView=0==b?calView(a+1,0,c,0):calView(a,b+1,c,0),nextCalendarView.left=screenWidth+"dp";var thisCalendarView=calView(a,b,c,0);thisCalendarView.left="-1dp",monthTitle.text=monthName(b)+" "+a,calview.add(toolBar),calview.add(thisCalendarView),calview.add(nextCalendarView),calview.add(prevCalendarView);var slideNext=Titanium.UI.createAnimation({duration:500});slideNext.left=-1*screenWidth;var slideReset=Titanium.UI.createAnimation({duration:500});slideReset.left="-1";var slidePrev=Titanium.UI.createAnimation({duration:500});slidePrev.left=screenWidth;var prevflag=0;nextMonth.addEventListener("click",function(){1==prevflag&&(11==b?(b=0,a++):b++,0!=oldDay&&(oldDay.color="#3a4756",oldDay.backgroundColor="#DCDCDF"),oldDay.backgroundPaddingLeft="0dp",oldDay.backgroundPaddingBottom="0dp",day=0,mon=0,year=0,thisCalendarView.animate(slideNext),nextCalendarView.animate(slideReset),toolBarTitle.remove(nextMonth),toolBarTitle.add(prevMonth),setTimeout(function(){thisCalendarView.left=-1*screenWidth+"dp",nextCalendarView.left="-1dp",prevCalendarView=thisCalendarView,thisCalendarView=nextCalendarView,nextCalendarView=11==b?calView(a+1,0,c,0):calView(a,b+1,c,0),monthTitle.text=monthName(b)+" "+a,nextCalendarView.left=screenWidth+"dp",calview.add(nextCalendarView)},500),prevflag=0)}),toolBarTitle.add(prevMonth),prevMonth.addEventListener("click",function(){var e=new Date;e.setDate(mydate.getDate()-14),e.getMonth()!=b&&0==prevflag&&(0==b?(b=11,a--):b--,0!=oldDay&&(oldDay.color="#3a4756",oldDay.backgroundColor="#DCDCDF"),oldDay.backgroundPaddingLeft="0dp",oldDay.backgroundPaddingBottom="0dp",day=0,mon=0,year=0,thisCalendarView.animate(slidePrev),prevCalendarView.animate(slideReset),toolBarTitle.add(nextMonth),toolBarTitle.remove(prevMonth),setTimeout(function(){thisCalendarView.left=screenWidth+"dp",prevCalendarView.left="-1dp",nextCalendarView=thisCalendarView,thisCalendarView=prevCalendarView,prevCalendarView=0==b?calView(a-1,11,c,1):calView(a,b-1,c,1),monthTitle.text=monthName(b)+" "+a,prevCalendarView.left=-1*screenWidth+"dp",calview.add(prevCalendarView)},500),prevflag=1)});var ratingLabel=Ti.UI.createLabel({text:"Please rate your mood after exercise",color:"white",font:{fontSize:20},top:"81%",textAlign:Ti.UI.TEXT_ALIGNMENT_CENTER});whatView.add(ratingLabel);var hstar1=Ti.UI.createButton({top:"85%",left:"3%",color:"white",width:55,height:55,backgroundImage:"./images/goldstar.png"});hstar1.addEventListener("click",function(){hstar1.backgroundImage="./images/goldstar.png",hstar2.backgroundImage="./images/dullstar.png",hstar3.backgroundImage="./images/dullstar.png",hstar4.backgroundImage="./images/dullstar.png",hstar5.backgroundImage="./images/dullstar.png",haprate=1});var hstar2=Ti.UI.createButton({top:"85%",left:"22%",color:"white",width:55,height:55,backgroundImage:"./images/goldstar.png"});hstar2.addEventListener("click",function(){hstar1.backgroundImage="./images/goldstar.png",hstar2.backgroundImage="./images/goldstar.png",hstar3.backgroundImage="./images/dullstar.png",hstar4.backgroundImage="./images/dullstar.png",hstar5.backgroundImage="./images/dullstar.png",haprate=2});var hstar3=Ti.UI.createButton({top:"85%",left:"41%",color:"white",width:55,height:55,backgroundImage:"./images/goldstar.png"});hstar3.addEventListener("click",function(){hstar1.backgroundImage="./images/goldstar.png",hstar2.backgroundImage="./images/goldstar.png",hstar3.backgroundImage="./images/goldstar.png",hstar4.backgroundImage="./images/dullstar.png",hstar5.backgroundImage="./images/dullstar.png",haprate=3});var hstar4=Ti.UI.createButton({top:"85%",left:"60%",color:"white",width:55,height:55,backgroundImage:"./images/dullstar.png"});hstar4.addEventListener("click",function(){hstar1.backgroundImage="./images/goldstar.png",hstar2.backgroundImage="./images/goldstar.png",hstar3.backgroundImage="./images/goldstar.png",hstar4.backgroundImage="./images/goldstar.png",hstar5.backgroundImage="./images/dullstar.png",haprate=4});var hstar5=Ti.UI.createButton({top:"85%",left:"79%",color:"white",width:55,height:55,backgroundImage:"./images/dullstar.png"});hstar5.addEventListener("click",function(){hstar1.backgroundImage="./images/goldstar.png",hstar2.backgroundImage="./images/goldstar.png",hstar3.backgroundImage="./images/goldstar.png",hstar4.backgroundImage="./images/goldstar.png",hstar5.backgroundImage="./images/goldstar.png",haprate=5}),whatView.add(hstar1),whatView.add(hstar2),whatView.add(hstar3),whatView.add(hstar4),whatView.add(hstar5);var submit=Ti.UI.createButton({top:"91%",left:"40%",color:"black",font:{fontSize:20},width:80,height:80,title:"Submit",backgroundImage:"./images/gray.png",backgroundSelectedImage:"./images/green.png"});whatView.add(submit);var email=Ti.UI.createTextField({height:"40dp",width:"150dp",top:"10%",left:"40%",color:"black",borderStyle:Titanium.UI.INPUT_BORDERSTYLE_ROUNDED,keyboardType:Titanium.UI.KEYBOARD_EMAIL}),password=Ti.UI.createTextField({height:"40dp",width:"150dp",top:"30%",left:"40%",color:"black",borderStyle:Titanium.UI.INPUT_BORDERSTYLE_ROUNDED,passwordMask:"True"}),levelLabel=Ti.UI.createLabel({color:"white",font:{fontSize:20},text:"Current Level:",top:"10%",left:"40%",width:Ti.UI.SIZE,height:Ti.UI.SIZE}),track=Ti.UI.createView({top:"15%",left:"40%",width:180,height:"2%",backgroundColor:"red"}),progress=Ti.UI.createView({top:"0",left:"0",width:"5%",height:"100%",backgroundColor:"green"});track.add(progress),profileView.add(track);var pointLabel=Ti.UI.createLabel({color:"white",font:{fontSize:20},text:"Points Earned:",top:"18%",left:"40%",width:Ti.UI.SIZE,height:Ti.UI.SIZE});profileView.add(levelLabel),profileView.add(pointLabel);var recentLabel=Ti.UI.createLabel({color:"white",font:{fontSize:20},text:"Recent Activities:",top:"23%",left:"8%",width:Ti.UI.SIZE,height:Ti.UI.SIZE});profileView.add(recentLabel);var refresh=Ti.UI.createButton({top:"90%",left:"15%",color:"black",font:{fontSize:20},width:100,title:"Refresh",backgroundImage:"./images/grayrect.png",backgroundImageSelected:"./images/greenrect.png"});profileView.add(refresh);var deauth=Ti.UI.createButton({top:"90%",left:"53%",color:"black",width:100,font:{fontSize:20},title:"Log out",backgroundImage:"./images/grayrect.png",backgroundImageSelected:"./images/greenrect.png"}),emaillabel=Ti.UI.createLabel({color:"white",font:{fontSize:20},text:"Username",top:"10%",left:"10%",width:Ti.UI.SIZE,height:Ti.UI.SIZE}),passwordlabel=Ti.UI.createLabel({color:"white",font:{fontSize:20},text:"Password",top:"30%",left:"10%",width:Ti.UI.SIZE,height:Ti.UI.SIZE}),win2=Titanium.UI.createWindow({title:"Register Phone",backgroundColor:"black",backgroundRepeat:!0});win2.add(emaillabel),win2.add(passwordlabel),win2.add(password),win2.add(email);var register=Ti.UI.createButton({top:"40%",title:"Log in",color:"black",width:100,font:{fontSize:20},title:"Log in",backgroundImage:"./images/grayrect.png",backgroundImageSelected:"./images/greenrect.png"});win2.add(register);var day,mon,year,low,med,high,social,useractivity,workoutstate="";initialise(),here.addEventListener("click",function(){here.backgroundImage="images/greenrect.png",Titanium.Geolocation.getCurrentPosition(function(e){e.success?(workout=e.coords.latitude.toString()+","+e.coords.longitude.toString(),workoutstate="Here"):(alert("Could not find your current location, please try again"),here.backgroundImage="images/grayrect.png",workoutstate="Location unavailable",workout="")}),atgeo.backgroundImage="images/grayrect.png",otherloc.backgroundColor="white",otherloc.setHintText="Type other"}),atgeo.addEventListener("click",function(){""!=atgeotext?(atgeo.backgroundImage="images/greenrect.png",workout=atgeotext,workoutstate="Geo-fenced"):(atgeo.backgroundImage="images/grayrect.png",workoutstate="Location unavailable",workout="",alert("Set geo-fence at a location from the options menu")),here.backgroundImage="images/grayrect.png",otherloc.setHintText="Type other",otherloc.backgroundColor="white"}),otherloc.addEventListener("return",function(){""!=otherloc.value?(workout=otherloc.value,workoutstate=workout,otherloc.backgroundColor="00cc66"):(otherloc.setHintText="Type other",otherloc.backgroundColor="white",workoutstate="Location unavailable",workout=""),atgeo.backgroundImage="images/grayrect.png",here.backgroundImage="images/grayrect.png"}),activitybtn1.addEventListener("click",function(){useractivity="Running",othertxt.setHintText="Type other",othertxt.value="",othertxt.backgroundColor="white",activitybtn1.backgroundImage="./images/green.png",activitybtn2.backgroundImage="./images/gray.png",activitybtn3.backgroundImage="./images/gray.png",activitybtn4.backgroundImage="./images/gray.png",activitybtn5.backgroundImage="./images/gray.png"}),activitybtn2.addEventListener("click",function(){useractivity="Walking",othertxt.setHintText="Type other",othertxt.backgroundColor="white",othertxt.value="",activitybtn1.backgroundImage="./images/gray.png",activitybtn2.backgroundImage="./images/green.png",activitybtn3.backgroundImage="./images/gray.png",activitybtn4.backgroundImage="./images/gray.png",activitybtn5.backgroundImage="./images/gray.png"}),activitybtn3.addEventListener("click",function(){useractivity="Swimming",othertxt.setHintText="Type other",othertxt.backgroundColor="white",othertxt.value="",activitybtn1.backgroundImage="./images/gray.png",activitybtn2.backgroundImage="./images/gray.png",activitybtn3.backgroundImage="./images/green.png",activitybtn4.backgroundImage="./images/gray.png",activitybtn5.backgroundImage="./images/gray.png"}),activitybtn4.addEventListener("click",function(){useractivity="Cycling",othertxt.setHintText="Type other",othertxt.backgroundColor="white",othertxt.value="",activitybtn1.backgroundImage="./images/gray.png",activitybtn2.backgroundImage="./images/gray.png",activitybtn3.backgroundImage="./images/gray.png",activitybtn4.backgroundImage="./images/green.png",activitybtn5.backgroundImage="./images/gray.png"}),activitybtn5.addEventListener("click",function(){useractivity="Weights",othertxt.setHintText="Type other",othertxt.backgroundColor="white",othertxt.value="",activitybtn1.backgroundImage="./images/gray.png",activitybtn2.backgroundImage="./images/gray.png",activitybtn3.backgroundImage="./images/gray.png",activitybtn4.backgroundImage="./images/gray.png",activitybtn5.backgroundImage="./images/green.png"}),othertxt.addEventListener("return",function(){"android"==Titanium.Platform.name&&Ti.UI.Android.hideSoftKeyboard(),othertxt.blur(),""!=othertxt.value?(useractivity=othertxt.value,othertxt.backgroundColor="00cc66"):(othertxt.setHintText="Type other",useractivity="",othertxt.backgroundColor="white")}),othertxt.addEventListener("change",function(){activitybtn1.backgroundImage="./images/gray.png",activitybtn2.backgroundImage="./images/gray.png",activitybtn3.backgroundImage="./images/gray.png",activitybtn4.backgroundImage="./images/gray.png",activitybtn5.backgroundImage="./images/gray.png"});var submitReq=Titanium.Network.createHTTPClient();submit.addEventListener("click",function(){submit.backgroundImage="./images/green.png",submitReq=Titanium.Network.createHTTPClient(),submitReq.open("POST","http://owlympics.ecg.rice.edu:81/mobile/submit"),submitinfo(),submitReq.onload=function(){"Activity submission succeeded"==this.responseText&&(alert("Congratulations! Your hardwork earned you "+Math.floor(100*(low/45+med/30+high/20)+10*(social>0))+" points!"),profileUpdate(),scrollable.scrollToView(profileView)),initialise()},submit.backgroundImage="./images/gray.png"});var profileReq=Titanium.Network.createHTTPClient(),activityflag=0,activity1=new Array;profileReq.onload=function(){var e=JSON.parse(this.responseText);for(userPoints=e[0].points,progress.width=0==userPoints?"5%":userPoints>=400?180:180*userPoints/400,userLevel="Current Level: ",userLevel+=e[0].level,i=0;activityflag>i;i++)profilechildView.remove(activity1[i]);for(i=0;i<e[0].acts.length;i++){activity1[i]=Ti.UI.createLabel({color:"white",font:{fontSize:20},text:"Exercise",top:50*i,left:"10%",width:Ti.UI.SIZE,height:Ti.UI.SIZE}),activityflag=e[0].acts.length,profilechildView.add(activity1[i]);var t="";t=t+e[0].acts[i].name+" for "+e[0].acts[i].newpoints+" points on "+e[0].acts[i].month+"/"+e[0].acts[i].day+"/"+e[0].acts[i].year,activity1[i].setText(t)}levelLabel.setText(userLevel),point="Points Earned : "+userPoints,pointLabel.setText(point)},Ti.App.Properties.hasProperty("loggedBefore")&&profileUpdate(),refresh.addEventListener("click",function(){profileUpdate()});var deauthReq=Titanium.Network.createHTTPClient();deauthReq.onload=function(){"Deauthorization succeeded"==this.responseText?(alert("Log out successful!"),Ti.App.Properties.removeProperty("loggedBefore"),win2.open(),homeWin.close()):alert(this.responseText)},deauth.addEventListener("click",function(){if(Titanium.Network.networkType===Titanium.Network.NETWORK_NONE)alert("Could not Log out, Please check internet connection.");else{deauthReq.open("POST","http://owlympics.ecg.rice.edu:81/mobile/detach");var e={uuid:Titanium.Platform.id};deauthReq.send(e)}}),profileView.add(deauth);var registerReq=Titanium.Network.createHTTPClient();registerReq.onload=function(){"Authentication succeeded"==this.responseText?(alert("Account successfully registered."),homeWin.open(),scrollable.scrollToView(vertiscroll),initialise(),win2.close(),"android"==Titanium.Platform.name&&Ti.UI.Android.hideSoftKeyboard(),Ti.App.Properties.setInt("loggedBefore",1)):alert(this.responseText)},register.addEventListener("click",function(){if(""!=email.value&&""!=password.value){registerReq.open("POST","http://owlympics.ecg.rice.edu:81/mobile/register");var e={username:email.value,password:password.value,uuid:Titanium.Platform.id};registerReq.send(e)}else alert("Username/Password are required")}),Ti.App.Properties.hasProperty("loggedBefore")?(homeWin.open(),scrollable.scrollToView(vertiscroll),"android"==Titanium.Platform.name&&Ti.UI.Android.hideSoftKeyboard()):win2.open(),scrollable.addEventListener("singletap",function(){"android"==Titanium.Platform.name?Ti.UI.Android.hideSoftKeyboard():(othertxt.blur(),lowtxt.blur(),medtxt.blur(),hightxt.blur(),socialtxt.blur()),""!=othertxt.value?(useractivity=othertxt.value,othertxt.backgroundColor="00cc66"):(othertxt.setHintText="Type other",othertxt.backgroundColor="white"),lowtxt.backgroundColor="0"!=lowtxt.value&&""!=lowtxt.value?"00cc66":"white",medtxt.backgroundColor="0"!=medtxt.value&&""!=medtxt.value?"00cc66":"white",hightxt.backgroundColor="0"!=hightxt.value&&""!=hightxt.value?"00cc66":"white",socialtxt.backgroundColor="0"!=socialtxt.value&&""!=socialtxt.value?"00cc66":"white"});var addlabel=Ti.UI.createLabel({top:"10%",width:Ti.UI.SIZE,height:Ti.UI.SIZE,color:"white",text:"\nSet 50m Geofence \n\n\n\nor\n\nType the address without pin-code and press RETURN",font:{fontSize:20},textAlign:Ti.UI.TEXT_ALIGNMENT_CENTER}),address=Ti.UI.createTextField({height:"120dp",width:"300dp",top:"50%",left:"3%",font:{fontSize:20},color:"black",borderStyle:Titanium.UI.INPUT_BORDERSTYLE_ROUNDED}),addbutton=Ti.UI.createButton({top:"20%",left:"20back%",color:"black",font:{fontSize:20},width:200,title:"Current Location",backgroundImage:"./images/grayrect.png",backgroundImageSelected:"./images/greenrect.png"});optionsView.add(addbutton),addbutton.addEventListener("click",function(){Titanium.Geolocation.getCurrentPosition(function(e){if(e.success){currentlocation[0]=e.coords.latitude,currentlocation[1]=e.coords.longitude,coords.write(currentlocation[0]+","+currentlocation[1]),enterfile.write("0,",!0),stampfile.write("0,",!0);var t=new Date,a=MapModule.createAnnotation({latitude:currentlocation[0],longitude:currentlocation[1],title:"Current location at "+t.getHours()+":"+t.getMinutes(),pincolor:MapModule.ANNOTATION_GREEN});mapview.addAnnotation(a),atgeotext=e.coords.latitude.toString()+","+e.coords.longitude.toString(),initialise(),alert("Setting geofence of 50m around current location"),optionsView.hide(),scrollable.show(),scrollable.scrollToView(mapview)
}else alert("Current Location not updated, try again")})}),address.addEventListener("return",function(){if(""!=address.value){var e=Titanium.Network.createHTTPClient();Titanium.Network.networkType===Titanium.Network.NETWORK_NONE?alert("Error. Please check internet connection."):(url1="http://maps.google.com/maps/api/geocode/json?address="+address.value+"&sensor=true",e.open("GET",url1),e.send(),e.onload=function(){if(""!=this.responseText){var e=JSON.parse(this.responseText);coords.write(e.results[0].geometry.location.lat+","+e.results[0].geometry.location.lng+",",!0),enterfile.write("0,",!0),stampfile.write("0,",!0),Ti.Geolocation.forwardGeocoder(address.value,function(){var t=MapModule.createAnnotation({latitude:e.results[0].geometry.location.lat,longitude:e.results[0].geometry.location.lng,title:address.value,pincolor:MapModule.ANNOTATION_GREEN});mapview.addAnnotation(t)}),atgeotext=address.value,initialise(),alert("Setting geofence of 50m around "+address.value),optionsView.hide(),scrollable.show(),scrollable.scrollToView(mapview)}})}}),optionsView.add(address),optionsView.add(addlabel);var centerRadius=20,hour,min;Ti.Geolocation.locationServicesEnabled?(Ti.Geolocation.accuracy=Ti.Geolocation.ACCURACY_HUNDRED_METERS,Ti.Geolocation.distanceFilter=5,Ti.Geolocation.preferredProvider=Ti.Geolocation.PROVIDER_PROVIDER_NETWORK,Ti.Geolocation.addEventListener("location",function(e){if(e.error);else{var t=new Array,a=new Array,o=0;if(currentlocation[0]=e.coords.latitude,currentlocation[1]=e.coords.longitude,t[i]=parseFloat(enterfile.read().text.split(",")[i]),i=0,a[i]=parseFloat(stampfile.read().text.split(",")[i]),o=distance(e.coords.latitude,e.coords.longitude,parseFloat(coords.read().text.split(",")[2*i]),parseFloat(coords.read().text.split(",")[2*i+1])),centerRadius>o)t[i]||(t[i]=1,a[i]=e.coords.timestamp);else if(t[i]){var r=new Date;t[i]=0,hour=Math.floor((e.coords.timestamp-a[i])/36e5),min=Math.floor((e.coords.timestamp-a[i])/6e4)-6e4*hour,alert(hour>1?r.getHours()+":"+r.getMinutes()+"|Report your activities for "+hour+"hours and "+min+" mins? Distance ="+o:r.getHours()+":"+r.getMinutes()+"|Report your activities for "+min+" mins? Distance ="+o)}for(enterfile.deleteFile(),enterfile.createFile(),stampfile.deleteFile(),stampfile.createFile(),i=0;i<t.length;i++)enterfile.write(t[i]+",",!0),stampfile.write(a[i]+",",!0);var n=MapModule.createAnnotation({latitude:e.coords.latitude,longitude:e.coords.longitude,title:o,pincolor:MapModule.ANNOTATION_RED});mapview.addAnnotation(n)}})):alert("Please enable location services"),Ti.App.addEventListener("resume",function(){Ti.App.addEventListener("Gvariables",function(e){for(enterflag=e.enterflag,stamp=e.stamp,enterfile.deleteFile(),enterfile.createFile(),stampfile.deleteFile(),stampfile.createFile(),i=0;i<enterflag.length;i++)enterfile.write(enterflag[i]+",",!0),stampfile.write(stamp[i]+",",!0)})});