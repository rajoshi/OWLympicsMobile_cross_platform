function defineCloud(e){function t(e,t,r){if(void 0===t)throw"Argument "+e+" was not provided!";if(typeof t!=r)throw"Argument "+e+" was an unexpected type! Expected: "+r+", Received: "+typeof t}function r(r,a){t("data",r,"object"),t("callback",a,"function"),o(this),this.url||(this.url=this.restNamespace+"/"+this.restMethod+".json"),e.debug&&Ti.API.info('ACS Request: { url: "'+this.url+'", verb: "'+this.verb+'", data: '+JSON.stringify(r)+" })"),v.send(this.url,this.verb,r,function(t){if(a){var r=t.response||{};t.meta&&"ok"==t.meta.status?(r.success=!0,r.error=!1,r.meta=t.meta,e.debug&&Ti.API.info(JSON.stringify(r))):(r.success=!1,r.error=!0,r.code=t.meta?t.meta.code:t.statusCode,r.message=t.meta?t.meta.message:t.message||t.statusText,e.debug&&Ti.API.error(r.code+": "+r.message)),a(r)}})}function a(){r.call(this,2==arguments.length?arguments[0]:{},2==arguments.length?arguments[1]:arguments[0])}function n(e){r.call(this,{},e)}function o(e){e.restNamespace||(e.restNamespace=e.property.toLowerCase()),e.restMethod||(e.restMethod=e.method.toLowerCase())}function i(r,a){t("callback",a,"function");var n={};n.params=r||{},n.params.cb=function(t){if(a){var r=t||{};t&&t.access_token?(r.success=!0,r.error=!1,e.debug&&Ti.API.info("ACS Token: "+t.access_token+" Expires: "+t.expires_in)):(r.success=!1,r.error=!0,r.message="Cancelled",e.debug&&Ti.API.error("ACS "+r.message)),a(r)}},v.secureSend(this.method,n)}function s(){i.call(this,2==arguments.length?arguments[0]:{},2==arguments.length?arguments[1]:arguments[0])}function c(e,t){e[t>>5]|=128<<24-t%32,e[(t+64>>9<<4)+15]=t;for(var r=Array(80),a=1732584193,n=-271733879,o=-1732584194,i=271733878,s=-1009589776,c=0;c<e.length;c+=16){for(var d=a,u=n,h=o,g=i,p=s,m=0;80>m;m++){r[m]=16>m?e[c+m]:(r[m-3]^r[m-8]^r[m-14]^r[m-16])<<1|(r[m-3]^r[m-8]^r[m-14]^r[m-16])>>>31;var f,v=a<<5|a>>>27;f=20>m?n&o|~n&i:40>m?n^o^i:60>m?n&o|n&i|o&i:n^o^i,v=l(l(v,f),l(l(s,r[m]),20>m?1518500249:40>m?1859775393:60>m?-1894007588:-899497514)),s=i,i=o,o=n<<30|n>>>2,n=a,a=v}a=l(a,d),n=l(n,u),o=l(o,h),i=l(i,g),s=l(s,p)}return[a,n,o,i,s]}function l(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function d(e){for(var t=[],r=(1<<f)-1,a=0;a<e.length*f;a+=f)t[a>>5]|=(e.charCodeAt(a/f)&r)<<32-f-a%32;return t}function u(e,t,r,a,n){var o=!1;return this.appKey=e,this.oauthKey=t,this.oauthSecret=r,this.apiBaseURL=a?a:h.sdk.url.baseURL,this.authBaseURL=n?n:h.sdk.url.authBaseURL,this.useThreeLegged=function(e){o=e,this.oauthKey||(this.oauthKey=this.appKey)},this.isThreeLegged=function(){return o},this}var h,g={PROPERTY_TYPE_ONLY_LATEST:0,PROPERTY_TYPE_SLASH_COMBINE:1,PROPERTY_TYPE_IGNORE:2};g.build=function b(e,t){var r,a=t.children||[];for(r in a)if(a.hasOwnProperty(r)){var n=a[r],o=n.propertyTypes||t.propertyTypes||{};o.children=g.PROPERTY_TYPE_IGNORE;for(var i in t)if(t.hasOwnProperty(i))switch(o[i]||g.PROPERTY_TYPE_ONLY_LATEST){case g.PROPERTY_TYPE_ONLY_LATEST:n[i]=void 0===n[i]?t[i]:n[i];break;case g.PROPERTY_TYPE_SLASH_COMBINE:var s=[];t[i]&&s.push(t[i]),n[i]&&s.push(n[i]),n[i]=s.join("/")}n.method&&!n.children?e[n.method]=function(e){return function(){return e.executor.apply(e,arguments)}}(n):n.property&&b(e[n.property]={},n)}},g.build(e,{verb:"GET",executor:r,children:[{method:"hasStoredSession",executor:function(){return Ti.API.warn("Cloud.hasStoredSession has been deprecated. Use Cloud.sessionId property"),v.hasStoredSession()}},{method:"retrieveStoredSession",executor:function(){return Ti.API.warn("Cloud.retrieveStoredSession has been deprecated. Use Cloud.sessionId property"),v.retrieveStoredSession()}},{property:"ACLs",children:[{method:"create",verb:"POST"},{method:"update",verb:"PUT"},{method:"show"},{method:"remove",restMethod:"delete",verb:"DELETE"},{method:"addUser",restMethod:"add",verb:"POST"},{method:"removeUser",restMethod:"remove",verb:"DELETE"},{method:"checkUser",restMethod:"check"}]},{property:"Chats",children:[{method:"create",verb:"POST"},{method:"query"},{method:"remove",restMethod:"delete",verb:"DELETE"},{method:"queryChatGroups",restMethod:"query_chat_groups",executor:a},{method:"getChatGroups",restMethod:"get_chat_groups",executor:a}]},{property:"Checkins",children:[{method:"create",verb:"POST"},{method:"query",executor:a},{method:"show"},{method:"remove",restMethod:"delete",verb:"DELETE"}]},{property:"Clients",children:[{method:"geolocate",executor:a}]},{property:"Objects",executor:function(e,a){var n;e&&"object"==typeof e&&(t("data.classname",e.classname,"string"),o(this),this.url=this.restNamespace+"/"+e.classname+"/"+this.restMethod+".json",n=e.classname,delete e.classname),r.call(this,e,a),e.classname=n},children:[{method:"create",verb:"POST"},{method:"show"},{method:"update",verb:"PUT"},{method:"remove",restMethod:"delete",verb:"DELETE"},{method:"query"}]},{property:"Emails",restNamespace:"custom_mailer",children:[{method:"send",verb:"POST",restMethod:"email_from_template"}]},{property:"Events",children:[{method:"create",verb:"POST"},{method:"show"},{method:"showOccurrences",restMethod:"show/occurrences"},{method:"query",executor:a},{method:"queryOccurrences",restMethod:"query/occurrences",executor:a},{method:"search",executor:a},{method:"searchOccurrences",restMethod:"search/occurrences",executor:a},{method:"update",verb:"PUT"},{method:"remove",restMethod:"delete",verb:"DELETE"}]},{property:"Files",children:[{method:"create",verb:"POST"},{method:"query",executor:a},{method:"show"},{method:"update",verb:"PUT"},{method:"remove",restMethod:"delete",verb:"DELETE"}]},{property:"Friends",children:[{method:"add",verb:"POST"},{method:"requests",executor:a},{method:"approve",verb:"PUT"},{method:"remove",verb:"DELETE"},{method:"search"}]},{property:"GeoFences",restNamespace:"geo_fences",children:[{method:"create",verb:"POST"},{method:"update",verb:"PUT"},{method:"remove",restMethod:"delete",verb:"DELETE"},{method:"query"}]},{property:"KeyValues",children:[{method:"set",verb:"PUT"},{method:"get"},{method:"append",verb:"PUT"},{method:"increment",restMethod:"incrby",verb:"PUT"},{method:"remove",restMethod:"delete",verb:"DELETE"}]},{property:"Likes",children:[{method:"create",verb:"POST"},{method:"remove",restMethod:"delete",verb:"DELETE"}]},{property:"Messages",children:[{method:"create",verb:"POST"},{method:"reply",verb:"POST"},{method:"show"},{method:"showInbox",restMethod:"show/inbox",executor:a},{method:"showSent",restMethod:"show/sent",executor:a},{method:"showThreads",restMethod:"show/threads",executor:a},{method:"showThread",restMethod:"show/thread"},{method:"remove",restMethod:"delete",verb:"DELETE"},{method:"removeThread",restMethod:"delete/thread",verb:"DELETE"}]},{property:"Photos",children:[{method:"create",verb:"POST"},{method:"show"},{method:"search"},{method:"query",executor:a},{method:"update",verb:"PUT"},{method:"remove",restMethod:"delete",verb:"DELETE"}]},{property:"PhotoCollections",restNamespace:"collections",children:[{method:"create",verb:"POST"},{method:"show"},{method:"update",verb:"PUT"},{method:"search"},{method:"showSubcollections",restMethod:"show/subcollections"},{method:"showPhotos",restMethod:"show/photos"},{method:"remove",restMethod:"delete",verb:"DELETE"}]},{property:"Places",children:[{method:"create",verb:"POST"},{method:"search",executor:a},{method:"show"},{method:"update",verb:"PUT"},{method:"remove",restMethod:"delete",verb:"DELETE"},{method:"query",executor:a}]},{property:"Posts",children:[{method:"create",verb:"POST"},{method:"show"},{method:"query",executor:a},{method:"update",verb:"PUT"},{method:"remove",restMethod:"delete",verb:"DELETE"}]},{property:"PushNotifications",restNamespace:"push_notification",verb:"POST",children:[{method:"subscribe"},{method:"unsubscribe",verb:"DELETE"},{method:"notify"},{method:"query",verb:"GET"},{method:"subscribeToken",restMethod:"subscribe_token"},{method:"unsubscribeToken",restMethod:"unsubscribe_token",verb:"DELETE"},{method:"notifyTokens",restMethod:"notify_tokens"},{method:"resetBadge",restMethod:"reset_badge",verb:"PUT"},{method:"setBadge",restMethod:"set_badge",verb:"PUT",executor:a},{method:"queryChannels",restMethod:"channels/query",verb:"GET",executor:a},{method:"showChannels",restMethod:"channels/show",verb:"GET"}]},{property:"PushSchedules",restNamespace:"push_schedules",children:[{method:"create",restMethod:"create",verb:"POST"},{method:"query",restMethod:"query",executor:a},{method:"remove",restMethod:"delete",verb:"DELETE"}]},{property:"Reviews",children:[{method:"create",verb:"POST"},{method:"show"},{method:"query"},{method:"update",verb:"PUT"},{method:"remove",restMethod:"delete",verb:"DELETE"}]},{property:"SocialIntegrations",restNamespace:"users",children:[{method:"externalAccountLogin",restMethod:"external_account_login",verb:"POST"},{method:"externalAccountLink",restMethod:"external_account_link",verb:"POST"},{method:"externalAccountUnlink",restMethod:"external_account_unlink",verb:"DELETE"},{method:"searchFacebookFriends",restNamespace:"social",restMethod:"facebook/search_friends",executor:n}]},{property:"Statuses",children:[{method:"create",verb:"POST"},{method:"update",verb:"PUT"},{method:"show"},{method:"search"},{method:"query",executor:a},{method:"remove",restMethod:"delete",verb:"DELETE"}]},{property:"Users",children:[{method:"create",verb:"POST"},{method:"login",verb:"POST"},{method:"show"},{method:"showMe",restMethod:"show/me",executor:n},{method:"search",executor:a},{method:"query",executor:a},{method:"update",verb:"PUT"},{method:"logout",executor:function(e){r.call(this,{},function(t){v.reset(),e(t)})}},{method:"remove",restMethod:"delete",verb:"DELETE",executor:function(){var e=arguments;r.call(this,2==e.length?e[0]:{},function(t){v.reset(),(2==e.length?e[1]:e[0])(t)})}},{method:"requestResetPassword",restMethod:"request_reset_password"},{method:"resendConfirmation",restMethod:"resend_confirmation"},{method:"secureCreate",executor:s},{method:"secureLogin",executor:s},{method:"secureStatus",executor:function(){return v.checkStatus()}}]}]});var p;null==p&&(p={}),p.setProperties=function(e,t){if(null!=e&&null!=t)for(var r in t)e[r]=t[r];return e},p.setProperties(p,{percentEncode:function(e){if(null==e)return"";if(e instanceof Array){for(var t="";0<e.length;++e)""!=t&&(t+="&"),t+=p.percentEncode(e[0]);return t}return e=encodeURIComponent(e),e=e.replace(/\!/g,"%21"),e=e.replace(/\*/g,"%2A"),e=e.replace(/\'/g,"%27"),e=e.replace(/\(/g,"%28"),e=e.replace(/\)/g,"%29")},decodePercent:function(e){return null!=e&&(e=e.replace(/\+/g," ")),decodeURIComponent(e)},getParameterList:function(e){if(null==e)return[];if("object"!=typeof e)return p.decodeForm(e+"");if(e instanceof Array)return e;var t,r=[];for(t in e)r.push([t,e[t]]);return r},getParameterMap:function(e){if(null==e)return{};if("object"!=typeof e)return p.getParameterMap(p.decodeForm(e+""));if(e instanceof Array){for(var t={},r=0;r<e.length;++r){var a=e[r][0];void 0===t[a]&&(t[a]=e[r][1])}return t}return e},getParameter:function(e,t){if(!(e instanceof Array))return p.getParameterMap(e)[t];for(var r=0;r<e.length;++r)if(e[r][0]==t)return e[r][1];return null},formEncode:function(e){for(var t="",e=p.getParameterList(e),r=0;r<e.length;++r){var a=e[r][1];null==a&&(a=""),""!=t&&(t+="&"),t+=p.percentEncode(e[r][0])+"="+p.percentEncode(a)}return t},decodeForm:function(e){for(var t=[],e=e.split("&"),r=0;r<e.length;++r){var a=e[r];if(""!=a){var n,o=a.indexOf("=");0>o?(n=p.decodePercent(a),a=null):(n=p.decodePercent(a.substring(0,o)),a=p.decodePercent(a.substring(o+1))),t.push([n,a])}}return t},setParameter:function(e,t,r){var a=e.parameters;if(a instanceof Array){for(e=0;e<a.length;++e)a[e][0]==t&&(void 0===r?a.splice(e,1):(a[e][1]=r,r=void 0));void 0!==r&&a.push([t,r])}else a=p.getParameterMap(a),a[t]=r,e.parameters=a},setParameters:function(e,t){for(var r=p.getParameterList(t),a=0;a<r.length;++a)p.setParameter(e,r[a][0],r[a][1])},completeRequest:function(e,t){null==e.method&&(e.method="GET");var r=p.getParameterMap(e.parameters);null==r.oauth_consumer_key&&p.setParameter(e,"oauth_consumer_key",t.consumerKey||""),null==r.oauth_token&&null!=t.token&&p.setParameter(e,"oauth_token",t.token),null==r.oauth_version&&p.setParameter(e,"oauth_version","1.0"),null==r.oauth_timestamp&&p.setParameter(e,"oauth_timestamp",p.timestamp()),null==r.oauth_nonce&&p.setParameter(e,"oauth_nonce",p.nonce(6)),p.SignatureMethod.sign(e,t)},setTimestampAndNonce:function(e){p.setParameter(e,"oauth_timestamp",p.timestamp()),p.setParameter(e,"oauth_nonce",p.nonce(6))},addToURL:function(e,t){if(newURL=e,null!=t){var r=p.formEncode(t);0<r.length&&(newURL=0>e.indexOf("?")?newURL+"?":newURL+"&",newURL+=r)}return newURL},getAuthorizationHeader:function(e,t){for(var r='OAuth realm="'+p.percentEncode(e)+'"',a=p.getParameterList(t),n=0;n<a.length;++n){var o=a[n],i=o[0];0==i.indexOf("oauth_")&&(r+=","+p.percentEncode(i)+'="'+p.percentEncode(o[1])+'"')}return r},correctTimestamp:function(e){p.timeCorrectionMsec=1e3*e-(new Date).getTime()},timeCorrectionMsec:0,timestamp:function(){var e=(new Date).getTime()+p.timeCorrectionMsec;return Math.floor(e/1e3)},nonce:function(e){for(var t=p.nonce.CHARS,r="",a=0;e>a;++a)var n=Math.floor(Math.random()*t.length),r=r+t.substring(n,n+1);return r}}),p.nonce.CHARS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",p.declareClass=function(e,t,r){var a=e[t];if(e[t]=r,null!=r&&null!=a)for(var n in a)"prototype"!=n&&(r[n]=a[n]);return r},p.declareClass(p,"SignatureMethod",function(){}),p.setProperties(p.SignatureMethod.prototype,{sign:function(e){var t=this.getSignature(p.SignatureMethod.getBaseString(e));return p.setParameter(e,"oauth_signature",t),t},initialize:function(e,t){var r;r=null!=t.accessorSecret&&9<e.length&&"-Accessor"==e.substring(e.length-9)?t.accessorSecret:t.consumerSecret,this.key=p.percentEncode(r)+"&"+p.percentEncode(t.tokenSecret)}}),p.setProperties(p.SignatureMethod,{sign:function(e,t){var r=p.getParameterMap(e.parameters).oauth_signature_method;(null==r||""==r)&&(r="HMAC-SHA1",p.setParameter(e,"oauth_signature_method",r)),p.SignatureMethod.newMethod(r,t).sign(e)},newMethod:function(e,t){var r=p.SignatureMethod.REGISTERED[e];if(null!=r){var a=new r;return a.initialize(e,t),a}var r=Error("signature_method_rejected"),n="";for(a in p.SignatureMethod.REGISTERED)""!=n&&(n+="&"),n+=p.percentEncode(a);throw r.oauth_acceptable_signature_methods=n,r},REGISTERED:{},registerMethodClass:function(e,t){for(var r=0;r<e.length;++r)p.SignatureMethod.REGISTERED[e[r]]=t},makeSubclass:function(e){var t=p.SignatureMethod,r=function(){t.call(this)};return r.prototype=new t,r.prototype.getSignature=e,r.prototype.constructor=r},getBaseString:function(e){var t=e.action,r=t.indexOf("?");if(0>r)r=e.parameters;else for(var r=p.decodeForm(t.substring(r+1)),a=p.getParameterList(e.parameters),n=0;n<a.length;++n)r.push(a[n]);return p.percentEncode(e.method.toUpperCase())+"&"+p.percentEncode(p.SignatureMethod.normalizeUrl(t))+"&"+p.percentEncode(p.SignatureMethod.normalizeParameters(r))},normalizeUrl:function(e){var t=p.SignatureMethod.parseUri(e),e=t.protocol.toLowerCase(),r=t.authority.toLowerCase();if("http"==e&&80==t.port||"https"==e&&443==t.port){var a=r.lastIndexOf(":");a>=0&&(r=r.substring(0,a))}return(t=t.path)||(t="/"),e+"://"+r+t},parseUri:function(e){for(var t="source,protocol,authority,userInfo,user,password,host,port,relative,path,directory,file,query,anchor".split(","),e=/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@\/]*):?([^:@\/]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/.exec(e),r={},a=14;a--;)r[t[a]]=e[a]||"";return r},normalizeParameters:function(e){if(null==e)return"";for(var t=p.getParameterList(e),e=[],r=0;r<t.length;++r){var a=t[r];"oauth_signature"!=a[0]&&e.push([p.percentEncode(a[0])+" "+p.percentEncode(a[1]),a])}for(e.sort(function(e,t){return e[0]<t[0]?-1:e[0]>t[0]?1:0}),t=[],r=0;r<e.length;++r)t.push(e[r][1]);return p.formEncode(t)}}),p.SignatureMethod.registerMethodClass(["PLAINTEXT","PLAINTEXT-Accessor"],p.SignatureMethod.makeSubclass(function(){return this.key})),p.SignatureMethod.registerMethodClass(["HMAC-SHA1","HMAC-SHA1-Accessor"],p.SignatureMethod.makeSubclass(function(e){m="=";var t=this.key,r=d(t);16<r.length&&(r=c(r,t.length*f));for(var a=Array(16),t=Array(16),n=0;16>n;n++)a[n]=909522486^r[n],t[n]=1549556828^r[n];for(e=c(a.concat(d(e)),512+e.length*f),e=c(t.concat(e),672),r="",t=0;t<4*e.length;t+=3)for(a=(e[t>>2]>>8*(3-t%4)&255)<<16|(e[t+1>>2]>>8*(3-(t+1)%4)&255)<<8|e[t+2>>2]>>8*(3-(t+2)%4)&255,n=0;4>n;n++)r=8*t+6*n>32*e.length?r+m:r+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(a>>6*(3-n)&63);return r}));var m="",f=8;u.prototype.sendRequest=function(e,t,r,a){var n=h.js.sdk.utils.getAuthType(this);if(n==h.constants.unknown)a(h.constants.noAppKeyError);else{var o=this.apiBaseURL+"/"+h.sdk.url.version+"/"+e,o=n==h.constants.app_key?o+(h.constants.keyParam+this.appKey):o+(h.constants.oauthKeyParam+this.oauthKey);if(null==r&&(r={}),t=t?t.toUpperCase():h.constants.get_method,r[h.constants.suppressCode]="true",!this.isThreeLegged()){var i=h.js.sdk.utils.getCookie(h.constants.sessionId);i||(i=this.session_id),i&&(o=-1!=o.indexOf("?")?o+("&"+h.constants.sessionId+"="+i):o+("?"+h.constants.sessionId+"="+i))}if(this.isThreeLegged()&&(!this.accessToken&&(i=this.getSession())&&(this.accessToken=i.access_token),this.accessToken&&(r[h.constants.accessToken]=this.accessToken)),i=r,Ti.App.analytics){var s=i.analytics||{};s.id=Ti.Platform.createUUID(),Ti.Platform.id&&(s.mid=Ti.Platform.id),s.aguid=Ti.App.guid,s.event="cloud."+e.replace(/\//g,".").replace(/\.json/,""),s.deploytype=Ti.App.deployType||"development",s.sid=Ti.App.sessionId,i.ti_analytics=JSON.stringify(s)}if(r=h.js.sdk.utils.cleanInvalidData(r),e=h.js.sdk.utils.getFileObject(r)){try{var c;if(c=e.toString().match(/TiFilesystemFile/)?e.read():e,!c)return void a(h.constants.fileLoadError);r[h.constants.file]?(delete r[h.constants.file],r[h.constants.file]=c):r[h.constants.photo]&&(delete r[h.constants.photo],r[h.constants.photo]=c)}catch(l){return void a(h.constants.fileLoadError)}c={},(n==h.constants.oauth||n==h.constants.three_legged_oauth)&&(n={method:t,action:o,parameters:[]},h.js.sdk.utils.populateOAuthParameters(n.parameters,this.oauthKey),this.oauthSecret&&p.completeRequest(n,{consumerSecret:this.oauthSecret}),c[h.constants.oauth_header]=p.getAuthorizationHeader("",n.parameters))}else if(c={},n==h.constants.oauth||n==h.constants.three_legged_oauth){var d,n={method:t,action:o,parameters:[]};for(d in r)r.hasOwnProperty(d)&&n.parameters.push([d,r[d]]);h.js.sdk.utils.populateOAuthParameters(n.parameters,this.oauthKey),this.oauthSecret&&p.completeRequest(n,{consumerSecret:this.oauthSecret}),c[h.constants.oauth_header]=p.getAuthorizationHeader("",n.parameters)}h.js.sdk.utils.sendAppceleratorRequest(o,t,r,c,a,this)}},u.prototype.sendAuthRequest=function(e){if(h.js.sdk.utils.getAuthType(this)!==h.constants.three_legged_oauth)alert("wrong authorization type!");else{var e=e||{},t=this.authBaseURL,t=t+"/oauth/authorize"+(h.constants.oauthKeyParam+this.oauthKey),t=t+(h.constants.clientIdParam+this.oauthKey),t=t+(h.constants.responseTypeParam+"token"),e=e.params||{};e.action="login",e.url=t;var r=this,a=e.cb;a&&delete e.cb,h.js.sdk.ui(e,function(e){r.saveSession(e),a&&a(e)})}},u.prototype.signUpRequest=function(e){if(h.js.sdk.utils.getAuthType(this)!==h.constants.three_legged_oauth)alert("wrong authorization type!");else{var e=e||{},t=this.authBaseURL,t=t+"/users/sign_up"+(h.constants.oauthKeyParam+this.oauthKey),t=t+(h.constants.clientIdParam+this.oauthKey),e=e.params||{};e.action="signup",e.url=t;var r=this,a=e.cb;a&&delete e.cb,h.js.sdk.ui(e,function(e){r.saveSession(e),a&&a(e)})}},u.prototype.saveSession=function(e){return e&&e.access_token?(h.js.sdk.utils.setCookie(h.constants.accessToken,e.access_token),h.js.sdk.utils.setCookie(h.constants.expiresIn,e.expires_in),this.accessToken=e.access_token,this.expiresIn=e.expires_in,this.authorized=!0):this.authorized=!1},u.prototype.getSession=function(){var e={};return e.access_token=h.js.sdk.utils.getCookie(h.constants.accessToken),e.expires_in=h.js.sdk.utils.getCookie(h.constants.expiresIn),e.access_token?(this.accessToken=e.access_token,this.expiresIn=e.expires_in,this.authorized=!0,e):this.authorized=!1},u.prototype.clearSession=function(){h.js.sdk.utils.setCookie(h.constants.accessToken,""),h.js.sdk.utils.setCookie(h.constants.expiresIn,""),delete this.accessToken,delete this.expiresIn,this.authorized=!1},u.prototype.checkStatus=function(){return this.getSession()?!0:!1},h=void 0,h={constants:{},js:{}},h.js.sdk={},h.js.sdk.utils={},h.sdk={},h.sdk.url={},h.sdk.url.baseURL="https://api.cloud.appcelerator.com",h.sdk.url.authBaseURL="https://secure-identity.cloud.appcelerator.com",h.sdk.url.version="v1",h.constants.get_method="GET",h.constants.post_method="POST",h.constants.put_method="PUT",h.constants.delete_method="DELETE",h.constants.app_key=1,h.constants.oauth=2,h.constants.three_legged_oauth=3,h.constants.unknown=-1,h.constants.keyParam="?key=",h.constants.oauthKeyParam="?oauth_consumer_key=",h.constants.clientIdParam="&client_id=",h.constants.redirectUriParam="&redirect_uri=",h.constants.responseTypeParam="&response_type=",h.constants.accessToken="access_token",h.constants.expiresIn="expires_in",h.constants.appKey="app_key",h.constants.json="json",h.constants.sessionId="_session_id",h.constants.sessionCookieName="Cookie",h.constants.responseCookieName="Set-Cookie",h.constants.file="file",h.constants.suppressCode="suppress_response_codes",h.constants.response_wrapper="response_wrapper",h.constants.photo="photo",h.constants.method="_method",h.constants.name="name",h.constants.value="value",h.constants.oauth_header="Authorization",h.constants.noAppKeyError={meta:{status:"fail",code:409,message:"Application key is not provided."}},h.constants.fileLoadError={meta:{status:"fail",code:400,message:"Unable to load file"}},h.js.sdk.utils.getSessionParams=function(){var e=null,t=h.js.sdk.utils.getCookie(h.constants.sessionId);return t&&(e=h.constants.sessionId+"="+t),e},h.js.sdk.utils.cookieMap=[],h.js.sdk.utils.cookieMap[h.constants.sessionId]="sessionId",h.js.sdk.utils.cookieMap[h.constants.accessToken]="accessToken",h.js.sdk.utils.cookieMap[h.constants.expiresIn]="expiresIn",h.js.sdk.utils.getCookie=function(t){return(t=h.js.sdk.utils.cookieMap[t])&&e[t]||null},h.js.sdk.utils.setCookie=function(t,r){var a=h.js.sdk.utils.cookieMap[t];a&&(""===r?delete e[a]:e[a]=r)},h.js.sdk.utils.deleteCookie=function(t){(t=h.js.sdk.utils.cookieMap[t])&&delete e[t]},h.js.sdk.utils.getAuthType=function(e){if(e){if(e.isThreeLegged())return h.constants.three_legged_oauth;if(e.appKey)return h.constants.app_key;if(e.oauthKey&&e.oauthSecret)return h.constants.oauth}return h.constants.unknown},h.js.sdk.utils.getFileObject=function(e){if(e)for(var t in e)if(e.hasOwnProperty(t)&&(t==h.constants.photo||t==h.constants.file))return e[t];return null},h.js.sdk.utils.cleanInvalidData=function(e){if(e){for(var t in e)if(e.hasOwnProperty(t)){if(null==e[t]&&delete e[t],"object"==typeof e[t]){if(t==h.constants.photo||t==h.constants.file)continue;e[t]=JSON.stringify(e[t])}(!0===e[t]||!1===e[t])&&(e[t]=e[t]?1:0)}return e}return{}},h.js.sdk.utils.uploadMessageCallback=function(e){return e&&e.data?JSON.parse(e.data):{}},h.js.sdk.utils.getOAuthParameters=function(e){var t="";if(e)for(var e=p.getParameterList(e),r=0;r<e.length;++r){var a=e[r],n=a[0];0==n.indexOf("oauth_")&&"oauth_token"!=n&&(t+="&"+p.percentEncode(n)+"="+p.percentEncode(a[1]))}return 0<t.length&&(t=t.substring(1)),t},h.js.sdk.utils.populateOAuthParameters=function(e,t){e&&t&&(e.push(["oauth_version","1.0"]),e.push(["oauth_consumer_key",t]),e.push(["oauth_signature_method","HMAC-SHA1"]),e.push(["oauth_nonce",p.nonce(15)]))},h.js.sdk.utils.sendAppceleratorRequest=function(t,r,a,n,o,i){var s=Ti.Network.createHTTPClient({timeout:6e4,onsendstream:function(r){e.onsendstream&&e.onsendstream({url:t,progress:r.progress})},ondatastream:function(r){e.ondatastream&&e.ondatastream({url:t,progress:r.progress})},onerror:function(e){var t={};if(this.responseText){var r=this.responseText;try{(r=r.trim())&&0<r.length&&(t=JSON.parse(r))}catch(a){t=a}}t.message||(t.message=e.error),t.error=!0,t.statusText=this.statusText,t.status=this.status,t.meta&&(t.metaString=JSON.stringify(t.meta)),o(t)},onload:function(){var e=JSON.parse(this.responseText);if(e&&e.meta&&(e.metaString=JSON.stringify(e.meta),e.meta.session_id)){var t=e.meta.session_id;h.js.sdk.utils.setCookie(h.constants.sessionId,t),i.session_id=t}o(e)}}),c=t;if(r.toUpperCase()==h.constants.get_method||r.toUpperCase()==h.constants.delete_method){var l,d="";for(l in a)a.hasOwnProperty(l)&&(d+="&"+l+"="+p.percentEncode(a[l]));0<d.length&&(c=0<t.indexOf("?")?c+d:c+("?"+d.substring(1)),a={})}if(e.debug&&(Ti.API.info(r+": "+c),Ti.API.info("header: "+JSON.stringify(n)),Ti.API.info("data: "+JSON.stringify(a))),s.open(r,c),"mobileweb"!=Ti.Platform.osname&&s.setRequestHeader("Accept-Encoding","gzip,deflate"),n)for(l in n)n.hasOwnProperty(l)&&s.setRequestHeader(l,n[l]);s.send(a)},h.js.sdk.utils.decodeQS=function(e){var t,r,a=decodeURIComponent,n={},e=e.split("&");for(t=0;t<e.length;t++)(r=e[t].split("=",2))&&r[0]&&(n[a(r[0])]=a(r[1]));return n},h.js.sdk.utils.guid=function(){return"f"+(1073741824*Math.random()).toString(16).replace(".","")},h.js.sdk.utils.copy=function(e,t,r,a){for(var n in t)(r||"undefined"==typeof e[n])&&(e[n]=a?a(t[n]):t[n]);return e};var v={session:null,fetchSetting:function(e,t){var r,a="production"==Ti.App.deployType.toLowerCase()?"production":"development";return(r=Ti.App.Properties.getString(e+"-"+a))&&"undefined"!=r||(r=Ti.App.Properties.getString(e))&&"undefined"!=r?r:t},fetchSession:function(){var e=v.fetchSetting("acs-api-key",null),t=v.fetchSetting("acs-base-url",h.sdk.url.baseURL),r=v.fetchSetting("acs-authbase-url",h.sdk.url.authBaseURL),a=v.fetchSetting("acs-oauth-key",null),n=v.fetchSetting("acs-oauth-secret",null);return new u(e,a,n,t,r)}};return v.getSession=function(){return null==v.session&&(v.session=v.fetchSession()),v.session},v.send=function(e,t,r,a){v.getSession().sendRequest(e,t,r,a)},v.hasStoredSession=function(){return!!h.js.sdk.utils.getCookie(h.constants.sessionId)},v.retrieveStoredSession=function(){return h.js.sdk.utils.getCookie(h.constants.sessionId)},v.reset=function(){h.js.sdk.utils.deleteCookie(h.constants.sessionId),v.session&&(v.session.clearSession(),v.session=null)},v.secureSend=function(e,t){var r=v.getSession();r.useThreeLegged(!0),"secureCreate"===e?r.signUpRequest(t):"secureLogin"===e&&r.sendAuthRequest(t)},v.checkStatus=function(){return v.getSession().checkStatus()},h.js.sdk.UIManager={redirect_uri:"acsconnect://success",displayModal:function(t){function r(e){var t=/^acsconnect:\/\/([^#]*)#(.*)/.exec(decodeURIComponent(e.url));if(t&&3==t.length){var s=null;if("success"==t[1])s=h.js.sdk.utils.decodeQS(t[2]);else if("cancel"!=t[1])return;o.removeEventListener("beforeload",r),o.removeEventListener("load",r),a=s,n&&n.close()}i&&"load"==e.type&&(n.remove(i),i=null)}e.debug&&Ti.API.info("ThreeLegged Request url: "+t.url);var a,n=Ti.UI.createWindow({modal:!0,title:t.params.title||"Appcelerator Cloud Service"}),o=Ti.UI.createWebView({url:t.url,scalesPageToFit:!1,showScrollbars:!0}),i=Ti.UI.createLabel({text:"Loading, please wait...",color:"black",width:Ti.UI.SIZE||"auto",height:Ti.UI.SIZE||"auto",zIndex:100});if(o.addEventListener("beforeload",r),o.addEventListener("load",r),n.addEventListener("close",function(){t&&(t.cb&&t.cb(a),o=n=i=t=a=null)}),"android"!=Ti.Platform.osname){var s=Ti.UI.createButton({title:"close",width:"50%",height:"20%"});s.addEventListener("click",function(){n.close()}),n.rightNavButton=s}n.add(o),n.add(i),n.open()},processParams:function(e,t){return{cb:t,url:e.url+h.constants.redirectUriParam+h.js.sdk.UIManager.redirect_uri,params:e}}},h.js.sdk.ui=function(e,t){if("mobileweb"===Ti.Platform.osname)alert("Three Legged OAuth is not currently supported on MobileWeb");else if(e.action){var r=h.js.sdk.UIManager.processParams(e,t);r&&h.js.sdk.UIManager.displayModal(r)}else alert('"action" is a required parameter for com.cocoafish.js.sdk.ui().')},e}defineCloud(exports);